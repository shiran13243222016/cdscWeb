<template>  <div class="block">    <v-Breadcrumb :post="bread"></v-Breadcrumb>    <div class="box">      <el-form ref="form" :inline="true" :model="form" label-width="80px" class="box_form">        <el-form-item label="代理账号:">          <el-input v-model="form.loginName" size="small"></el-input>        </el-form-item>        <el-form-item label="状态:">          <el-select v-model="form.agentState" placeholder="请选择" size="small">            <el-option label="全部" value=""></el-option>            <el-option label="正常" value="1"></el-option>            <el-option label="停用" value="2"></el-option>          </el-select>        </el-form-item>        <el-form-item style="margin-left: 20px;">          <el-button type="primary" size="small" @click="search">查询</el-button>          <el-button size="small" @click="reset">重置</el-button>        </el-form-item>      </el-form>      <div class="box_operating">        <el-button type="primary" icon="el-icon-edit" size="small" @click="addAgentAccount">新增</el-button>        <!--<el-button size="small">全部导出</el-button>-->      </div>      <el-table :data="tableData" :header-cell-style="tableHeaderColor" border stripe>        <el-table-column prop="loginName" label="一级代理账号" width="150"></el-table-column>        <el-table-column prop="secondCount" label="二级代理数量" sortable width="150"></el-table-column>        <el-table-column prop="userCount" label="用户数量" sortable width="150"></el-table-column>        <el-table-column prop="balance" label="可用资产" sortable width="150"></el-table-column>        <el-table-column prop="total" label="总返佣" sortable min-width="250" show-overflow-tooltip>          <template slot-scope="scope">            <span v-if="scope.row.total>=0&&scope.row.commisionRate>=0">              {{parseFloat(scope.row.total)*parseFloat(scope.row.commisionRate)}}            </span>          </template>        </el-table-column>        <el-table-column prop="commisionRate" label="返佣比例" sortable width="120">          <template slot-scope="scope">            <span>{{(scope.row.commisionRate*100).toFixed(2)}}%</span>          </template>        </el-table-column>        <el-table-column label="状态" sortable width="120">          <template slot-scope="scope">            <span v-if="scope.row.status==1">正常</span>            <span v-if="scope.row.status==2">停用</span>          </template>        </el-table-column>        <el-table-column label="操作" width="150">          <template slot-scope="scope">            <!--                    运营代理没有查看功能-->            <el-button type="text" v-if="roles==6" @click="editAgentAccount('view',scope.row)">查看</el-button>            <el-button type="text" @click="editAgentAccount('edit',scope.row)">编辑</el-button>            <el-dropdown>              <el-button type="text" class="el-dropdown-link">更多<i class="el-icon-arrow-down el-icon--right"></i></el-button>              <el-dropdown-menu slot="dropdown">                <el-dropdown-item>                  <el-button type="text" size="small" @click="operation('Password',scope.row.id)">                    重置登录密码                  </el-button>                </el-dropdown-item>                <el-dropdown-item>                  <el-button type="text" size="small" @click="operation('saferpass',scope.row.id)">                    重置安全密码                  </el-button>                </el-dropdown-item>                <el-dropdown-item>                  <el-button style="width:100%" type="text" size="small" v-if="scope.row.status==2"                             @click="operation('stoporstart',scope.row.id)">启用                  </el-button>                  <el-button style="width:100%" type="text" size="small" v-if="scope.row.status==1"                             @click="operation('stoporstart',scope.row.id)">停用                  </el-button>                </el-dropdown-item>              </el-dropdown-menu>            </el-dropdown>          </template>        </el-table-column>      </el-table>      <v-Paging></v-Paging>      <!--新增代理弹出框-->      <el-dialog :title="dialogTitle=='add'?'添加一级代理':dialogTitle=='edit'?'编辑一级代理':'查看'" :visible.sync="addAgent"                 width="35%" @close="close">        <el-alert v-if="dialogTitle=='add'"                  title="一级代理的默认登录密码和安全密码均为Abcd1234，登录后将提示其自行修改"                  type="success"                  show-icon>        </el-alert>        <el-alert v-show="dialogTitle=='edit'&&tips"                  title="请输入正确的返佣比例"                  type="info"                  show-icon>        </el-alert>        <el-form ref="form" :model="addAgent_form" label-width="120px" class="mgt20">          <el-form-item label="一级代理手机:" prop="iphone">            <el-input v-model="addAgent_form.loginName" placeholder="请输入" v-if="dialogTitle=='add'"></el-input>            <span v-else>{{addAgent_form.loginName}}</span>          </el-form-item>          <el-form-item label="返佣比例:" prop="scale">            <el-input v-model="addAgent_form.maid_scale" v-if="dialogTitle=='add'||dialogTitle=='edit'"                      @input="addAgent_form.maid_scale=addAgent_form.maid_scale.replace(/[^0-9.]/g,'')"                      placeholder="请输入返佣比例">              <template slot="append">%</template>            </el-input>            <span v-else>{{addAgent_form.maid_scale}}</span>          </el-form-item>          <el-form-item label="安全密码:" v-if="dialogTitle=='add'||dialogTitle=='edit'">            <el-input v-model="addAgent_form.savePassword" type="password" placeholder="请输入安全密码"></el-input>          </el-form-item>        </el-form>        <span slot="footer" v-if="dialogTitle=='add'||dialogTitle=='edit'">                <el-button @click="addAgent = false" size="small">取 消</el-button>                <el-button type="primary" @click="addOnAgent" size="small">确 定</el-button>          <!--                @keyup.enter.native="enterevent"-->            </span>      </el-dialog>    </div>  </div></template><script>	import vBreadcrumb from '@/components/common/Breadcrumb.vue';	import base from '@/components/common/base.vue';	export default {		mixins: [base],		components: {			vBreadcrumb		},		props: {			content: {				type: String,				default: () => {					return 'from child'				}			}		},		data() {			return {				bread: {					path: '/userAdmin',					data: '一级代理管理'				},				tips: false,				form: {					loginName: '',					agentState: ''				},				addAgent: false,  // 新增一级代理				addAgent_form: {					loginName: '',					maid_scale: 0,					listId: ''				},				dialogTitle: 'add'			}		},		computed: {			roles() {				if (this.$store.state.userInfo && this.$store.state.userInfo.userInfo) {					return this.$store.state.userInfo.userInfo.roleType;				}			},			invateCode() {				if (this.$store.state.userInfo && this.$store.state.userInfo.userInfo) {					return this.$store.state.userInfo.userInfo.inviteCode;				}			}		},		methods: {			//输入返佣比例			maidScale(value) {				if (value.length > 3) value = value.slice(0, 3)			},			reset() {				this.form.loginName = '';				this.form.agentState = '';				this.$store.dispatch('initiValue');				this.getData();			},			//编辑			editAgentAccount(type, data) {				this.dialogTitle = type;				this.addAgent = true;				this.addAgent_form = {					loginName: data.loginName,					listId: data.id,					maid_scale: (data.commisionRate * 100).toFixed(2)				};			},			close() {				this.addAgent_form = {					loginName: '',					maid_scale: 0,					listId: ''				};				this.tips = false;			},			addAgentAccount() {				this.dialogTitle = 'add';				this.addAgent = true;			},			// 新增一级代理			addOnAgent() {				if (this.dialogTitle == 'edit') {					if (this.addAgent_form.maid_scale <= 0 || this.addAgent_form.maid_scale >= 100) {						this.tips = true;						return;					}				}				if (this.addAgent_form.loginName && this.addAgent_form.maid_scale >= 0) {					let params = {						loginName: this.addAgent_form.loginName,						commisionRate: (Math.round(this.addAgent_form.maid_scale * 100) / 10000),						safePassword: this.addAgent_form.savePassword					};					if (this.dialogTitle == 'edit' && this.addAgent_form.listId) {						params.id = this.addAgent_form.listId					}					this.RestClient('CREATE', '/user/save', params).then((res) => {						if (res.data.code == 200) {							this.$message({								message: res.data.message,								type: 'success'							});							this.getData();							this.addAgent = false;							Object.keys(this.addAgent_form).forEach(key => this.addAgent_form[key] = '');						}					})				} else {					this.$message({						message: '代理手机或者返佣比例不能为空',						type: 'info'					});				}			},			formatter(row, column) {				return row.address;			},			//查询数据方法			search() {				let logiName = this.form.loginName;				this.getData(logiName);			},			// 获取一级代理列表数据			getData(loginName) {				let params = {					userType: 6,					status: this.form.agentState,					pageSize: this.pager.perPage,					pageNo: this.pager.page				};				if (loginName) {					params.loginName = loginName;				}				this.RestClient('GET_LIST', '/user/list', params).then((res) => {					if (res.data.code == 200) {						this.$store.dispatch('tableData',res.data.data);					}				})			},			RequestAjax(type, url, params, message) {				this.RestClient(type, url, params).then((res) => {					if (res.data.code == 200) {						this.$message({							message: res.data.message,							type: 'success'						});						this.getData();					}				})			},			//重置用户登陆密码			operation(url, id) {				let urls = '', message = '';				switch (url) {					case 'Password':						urls = '/user/resetPassword';						message = '重置登陆密码失败';						break;					case 'saferpass':						urls = '/user/resetSafePassword';						message = '重置安全密码失败';						break;					case 'stoporstart':						urls = '/user/stop';						message = '停用启用失败';						break;				}				let params = {					id: id				};				this.$prompt('请输入安全密码,重置后的密码为Abcd1234', '提示', {					confirmButtonText: '确定',					cancelButtonText: '取消',					inputPattern: /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{8,20}$/,					inputType: 'password',					inputErrorMessage: '密码需8~20位，不能为纯数字和纯字母'				}).then(({value}) => {					if (value) {						params.safePassword = value					}					this.RequestAjax('GET_LIST', urls, params, message)				}).catch(() => {					this.$message({						type: 'info',						message: '取消输入'					});				});			}		}	}</script><style lang="scss" scoped>  .block {    .block_top {      background: #fff;      height: 70px;      padding: 15px;      .column {        padding-top: 10px;      }    }    .box {      margin-top: 20px;      background: #fff;      padding: 20px;      .box_operating{        margin-bottom: 20px;      }      .box_form {        padding-top: 10px;      }      .box_table {        margin-top: 20px;        .box_table_drop {          color: #409EFF;        }      }      .el-dropdown-link {        margin-left: 10px;      }    }    .dialog_selected {      padding: 8px;      background: rgb(224, 246, 255);      border: 1px solid rgb(173, 225, 254);      i, span {        color: rgb(25, 120, 254);      }    }  }</style>