<template>  <div class="block">    <v-Breadcrumb :post="bread"></v-Breadcrumb>    <el-row class="block_box">      <el-tabs :tab-position="tabPosition" style="height: 580px;">        <el-tab-pane label="基本设置">          <h3>基本设置</h3>          <el-form :model="form">            <el-row :gutter="20">              <el-col :span="13">                <el-form-item class="mgt10">                  <p>账号或邮箱</p>                  <el-input v-model="form.loginName" size="small" disabled></el-input>                </el-form-item>                <el-form-item>                  <p>昵称</p>                  <el-input v-model="form.nickname" size="small" @input="onChange" maxlength="11"></el-input>                </el-form-item>                <el-form-item v-if="roles !==2">                  <p>返佣比</p>                  <el-input v-model="form.commisionRate" size="small" disabled placeholder="返佣比"></el-input>                </el-form-item>                <el-form-item class="mgt">                  <el-button type="primary" :disabled="is_disabled" @click="upUserInfo">更新信息</el-button>                </el-form-item>              </el-col>              <!--<el-col :span="11" style="padding-left:100px;">-->              <!--  <el-form-item>-->              <!--    <p>头像</p>-->              <!--    <el-upload-->              <!--       class="avatar-uploader"-->              <!--       action=""-->              <!--       :show-file-list="false"-->              <!--       :on-success="handleAvatarSuccess"-->              <!--       :before-upload="beforeAvatarUpload">-->              <!--      <img v-if="form.avatar" :src="form.avatar" class="avatar">-->              <!--      <i v-else class="el-icon-plus avatar-uploader-icon"></i>-->              <!--     </el-upload>-->              <!--   </el-form-item>-->              <!--</el-col>-->            </el-row>          </el-form>        </el-tab-pane>        <el-tab-pane label="安全设置">          <h3>安全设置</h3>          <div class="block_box_flex">            <div class="block_box_flex_left">              <p>登录密码</p>              <span>当前密码强度： <em>强</em></span>            </div>            <div class="block_box_flex_right">              <el-button type="text" @click="opera_loginPass = true">修改</el-button>            </div>          </div>          <div class="block_box_flex">            <div class="block_box_flex_left">              <p>安全密码</p>              <span>当前密码强度： <em>强</em></span>            </div>            <div class="block_box_flex_right">              <el-button type="text" @click="opera_safePass = true">修改</el-button>            </div>          </div>        </el-tab-pane>      </el-tabs>    </el-row>    <!--修改登录密码-->    <el-dialog title="修改登录密码" :visible.sync="opera_loginPass" width="35%">      <div class="dialog_selected" v-if="opera_loginShow">        <p><i class="el-icon-info"></i> 两次密码不一致</p>      </div>      <el-form ref="form" :model="opera_loginPass_form" label-width="120px" class="mgt20">        <el-form-item label="当前密码:" prop="password">          <el-input v-model="opera_loginPass_form.password" show-password placeholder="请输入" size="small"></el-input>        </el-form-item>        <el-form-item label="新密码:" prop="newPassword">          <el-input v-model="opera_loginPass_form.newPassword" show-password placeholder="6-16位密码，区分大小写" size="small"></el-input>        </el-form-item>        <el-form-item label="确认密码:" prop="newPassword">          <el-input v-model="opera_loginPass_form.repeatNewPassword" show-password placeholder="6-16位密码，区分大小写" size="small"></el-input>        </el-form-item>      </el-form>      <span slot="footer">        <el-button @click="opera_loginPass = false" size="small">取 消</el-button>        <el-button type="primary" @click="upLoginPass" size="small">确 定</el-button>      </span>    </el-dialog>    <!--修改安全密码-->    <el-dialog title="修改安全密码" :visible.sync="opera_safePass" width="35%">      <div class="dialog_selected" v-if="opera_safeShow">        <p><i class="el-icon-info"></i> 两次密码不一致</p>      </div>      <el-form ref="form" :model="opera_safePass_form" label-width="120px" class="mgt20">        <el-form-item label="当前密码:" prop="password">          <el-input v-model="opera_safePass_form.password" show-password placeholder="请输入" size="small"></el-input>        </el-form-item>        <el-form-item label="新密码:" prop="newPassword">          <el-input v-model="opera_safePass_form.newPassword" show-password placeholder="6-16位密码，区分大小写" size="small"></el-input>        </el-form-item>        <el-form-item label="确认密码:" prop="newPassword">          <el-input v-model="opera_safePass_form.repeatNewPassword" show-password placeholder="6-16位密码，区分大小写" size="small"></el-input>        </el-form-item>      </el-form>      <span slot="footer">        <el-button @click="opera_safePass = false" size="small">取 消</el-button>        <el-button type="primary" @click="upSafePass" size="small">确 定</el-button>      </span>    </el-dialog>  </div></template><script>	import vBreadcrumb from '@/components/common/Breadcrumb.vue';	export default {		components: {			vBreadcrumb		},		computed: {			roles() {				if (this.$store.state.userInfo && this.$store.state.userInfo.userInfo) {					return this.$store.state.userInfo.userInfo.roleType;				}			}		},		created() {			this.getUserInfo();		},		data() {			return {				bread: {    // 面包屑					path: '/userAdmin',					data: '个人设置'				},				tabPosition: 'left', // tabPosition组件左对齐				form: {            // 基本表单信息					loginName: '',					nickname: '',					commisionRate: '',					avatar: ''				},				oldnickname: '',				is_disabled: true,       // 更新基本信息				opera_loginPass: false,   // 修改登录密码				opera_loginShow: false,				opera_loginPass_form: {					password: '',					newPassword: '',					repeatNewPassword: ''				},				opera_safePass: false,  // 修改安全密码				opera_safeShow: false,				opera_safePass_form: {					password: '',					newPassword: '',					repeatNewPassword: ''				}			}		},		methods: {			handleAvatarSuccess(res, file) {				this.form.avatar = URL.createObjectURL(file.raw);			},			beforeAvatarUpload(file) {				const isJPG = file.type === 'image/jpeg';				const isLt2M = file.size / 1024 / 1024 < 2;				if (!isJPG) {					this.$message.error('上传头像图片只能是 JPG 格式!');				}				if (!isLt2M) {					this.$message.error('上传头像图片大小不能超过 2MB!');				}				return isJPG && isLt2M;			},			// 修改我的信息			upUserInfo() {				let params = {					nickname: this.form.nickname,					loginName: this.form.loginName,					// avatar:this.form.avatar,					commisionRate: this.form.commisionRate				};				this.RestClient('CREATE', '/user/info', params).then((res) => {					if (res.data.code == 200) {						this.$message({							message: res.data.message,							type: 'success'						});						this.getUserInfo();						this.updateInfo();					}				})			},			getUserInfo() {				this.RestClient('GET_BASE', '/user/info').then((res) => {					if (res.data.code == 200) {						this.form.commisionRate = parseFloat(res.data.data.commisionRate) * 100 + '%';						this.form.loginName = res.data.data.loginName;						this.form.nickname = res.data.data.nickname;						this.oldnickname = res.data.data.nickname;						if (res.data.data.avatar) {							this.form.avatar = res.data.data.avatar.replace(/blob:/g, "");						}						this.$store.commit('getUserInfo', {userInfo: res.data.data});					}				})			},			// 当账号或昵称值发生变化时更新信息按钮可使用			onChange(value) {				if (this.form.nickname !== this.oldnickname) {					this.is_disabled = false;				} else {					this.is_disabled = true;				}			},			updateInfo() {				this.RestClient('GET_BASE', '/user/info').then((res) => {					if (res.data.code == 200) {						this.$store.commit('setNickname', res.data.data.nickname);						this.$store.commit('getUserInfo', {userInfo: res.data.data});						this.$store.commit('addRole', res.data.data.roleType);					}				})			},			// 修改登录密码			upLoginPass() {				if (this.opera_loginPass_form.password && this.opera_loginPass_form.newPassword && this.opera_loginPass_form.repeatNewPassword) {					if (this.opera_loginPass_form.newPassword == this.opera_loginPass_form.repeatNewPassword) {						let params = {							oldPassword: this.opera_loginPass_form.password,							newPassword: this.opera_loginPass_form.newPassword						};						this.RestClient('CREATE', '/user/password', params).then((res) => {							if (res.data.code == 200) {								this.$message({									message: res.data.message,									type: 'success'								});								sessionStorage.removeItem('isDefaultPassword');								Object.keys(this.opera_loginPass_form).forEach(key => this.opera_loginPass_form[key] = '');								this.opera_loginPass = false							}						})					} else {						this.opera_loginShow = true					}				}			},			// 修改安全密码			upSafePass() {				if (this.opera_safePass_form.password && this.opera_safePass_form.newPassword && this.opera_safePass_form.repeatNewPassword) {					if (this.opera_safePass_form.newPassword == this.opera_safePass_form.repeatNewPassword) {						let params = {							oldSafePassword: this.opera_safePass_form.password,							newSafePassword: this.opera_safePass_form.newPassword						};						this.RestClient('CREATE', '/user/safePassword', params).then((res) => {							if (res.data.code == 200) {								this.$message({									message: res.data.message,									type: 'success'								});								Object.keys(this.opera_safePass_form).forEach(key => this.opera_safePass_form[key] = '');								this.opera_safePass = false							}						})					} else {						this.opera_safeShow = true					}				}			}		}	}</script><style lang="scss" scoped>  .block {    .block_box {      background: #fff;      height: 600px;      padding: 10px;      .mgt {        margin-top: 180px;      }      .avatar {        width: 156px;        height: 156px;        display: block;      }      .avatar-uploader-icon {        font-size: 28px;        color: #8c939d;        width: 156px;        height: 156px;        line-height: 156px;        text-align: center;      }      .avatar-uploader .el-upload {        border: 1px dashed #d9d9d9;        border-radius: 6px;        cursor: pointer;        position: relative;        overflow: hidden;      }      .block_box_flex {        font-size: 14px;        margin-top: 30px;        border-bottom: 1px solid rgb(228, 228, 228);        padding-bottom: 20px;        width: 95%;        display: flex;        justify-content: space-between;        .block_box_flex_left {          span {            color: rgb(149, 149, 149);            em {              color: #52C41A;            }          }        }        .block_box_flex_right {          color: #1890FF;        }      }    }    .dialog_selected {      padding: 8px;      background: rgb(255, 238, 238);      border: 1px solid rgb(253, 144, 140);      i, span {        color: rgb(253, 144, 140);      }    }  }</style>